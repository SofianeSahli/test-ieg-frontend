<div class="card post-card">
  <div class="img-container">
    @if(post.picture){
    <img
      [src]="imageUrl(post.picture)"
      class="img-container-img"
      alt="Thumbnail"
      (click)="openImageModal()"
    />

    }@else {
    <img
      [src]="'assets/images/no-thumbnail.webp'"
      class="img-container-img"
      alt="Post image"
    />

    }
  </div>

  <div class="card-body">
    <h5 class="card-title">{{ post.title }}</h5>
    <p class="card-text">{{ post.text }}</p>
    @if(post.user){
    <small class="text-muted">
      By {{ post.user.firstName || "Anonymous" }} ‚Äî
      {{ post.createdAt | date : "short" }}
    </small>
    }
    <div class="mt-3 d-flex align-items-center gap-2">
      <button class="btn btn-outline-primary btn-sm" (click)="toggleLike()">
        üëç {{ likes }}
      </button>
    </div>

    <div class="mt-3">
      <input
        type="text"
        [(ngModel)]="newComment"
        placeholder="Commentez..."
        class="form-control form-control-sm mb-2"
      />
      <div class="d-flex justify-content-between">
        <button class="add-item-button" (click)="addComment()">
          {{ "labels.add_comment" | translate }}
        </button>
        @if((userProfile$ | async)?._id === post.userId ){
        <div class="d-flex justify-content-end">
          <button
            class="delete-button"
            style="margin-right: 4px"
            (click)="onDelete(post)"
          >
            {{ "labels.delete" | translate }}
          </button>

          <button
            class="details-button"
            (click)="details()"
            style="margin-left: 4px"
          >
            {{ "labels.details" | translate }}
          </button>
        </div>

        }
      </div>
    </div>
    @if(post.comments && post.comments.length > 0){
    <ul class="list-group list-group-flush mt-3">
      @for(c of post.comments; track c._id){
      <li class="list-group-item p-1 d-flex align-items-center gap-2">
        <img
          *ngIf="c.user?.profilePicture"
          [src]="c.user.profilePicture"
          alt="Avatar"
          class="rounded-circle"
          style="width: 24px; height: 24px; object-fit: cover"
        />
        <div>
          <strong
            >{{ c.user?.firstName || "Unknown" }}
            {{ c.user?.lastName || "" }}</strong
          >
          <small class="text-muted ms-2" style="font-size: 0.75rem">
            {{ c.createdAt | date : "short" }}
          </small>
          <div>{{ c.text }}</div>
        </div>
      </li>
      }
    </ul>
    }
  </div>
</div>
